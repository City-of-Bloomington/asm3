New England State Report
###
Movements
###
2870/PostgreSQL
###
Summary of adoptions between two dates with the city/state of brought in owner
###
en
###
$VAR from DATE Adopted between$
$VAR to DATE and$

SELECT m.MovementDate AS DateDogAcquired,
bo.OwnerTown || ', ' || bo.OwnerCounty AS AcquiredFrom,
s.SpeciesName, a.AnimalName, a.AnimalAge, 
CASE WHEN a.Sex = 2 THEN 'U' WHEN a.Sex = 1 THEN 'M' WHEN a.Sex = 0 THEN 'F' END AS Sex,
a.BreedName,
(SELECT DateOfVaccination FROM animalvaccination av INNER JOIN vaccinationtype vt ON av.VaccinationID = vt.ID WHERE av.AnimalID = a.ID AND vt.VaccinationType LIKE 'Rabies%' ORDER BY DateOfVaccination DESC LIMIT 1) AS DateOfRabies,
(SELECT DateOfVaccination FROM animalvaccination av INNER JOIN vaccinationtype vt ON av.VaccinationID = vt.ID WHERE av.AnimalID = a.ID AND vt.VaccinationType LIKE 'DH%PP%' ORDER BY DateOfVaccination DESC LIMIT 1) AS DateOfDHPP,
(SELECT DateOfVaccination FROM animalvaccination av INNER JOIN vaccinationtype vt ON av.VaccinationID = vt.ID WHERE av.AnimalID = a.ID AND vt.VaccinationType LIKE 'FVCRP%' ORDER BY DateOfVaccination DESC LIMIT 1) AS DateOfFVCRP,
(SELECT DateOfVaccination FROM animalvaccination av INNER JOIN vaccinationtype vt ON av.VaccinationID = vt.ID WHERE av.AnimalID = a.ID AND vt.VaccinationType LIKE 'Lepto%' ORDER BY DateOfVaccination DESC LIMIT 1) AS DateOfLepto,
CASE WHEN a.HeartwormTested = 1 THEN HeartwormTestDate ELSE NULL END AS DateOf4DX,
CASE WHEN a.HeartwormTested = 1 THEN (SELECT Name FROM lksposneg WHERE ID = a.HeartwormTestResult) ELSE '' END AS ResultOf4DX,
a.MostRecentEntryDate AS DateOfImport
FROM adoption m
INNER JOIN animal a ON m.AnimalID = a.ID
INNER JOIN species s ON s.ID = a.SpeciesID
LEFT OUTER JOIN owner bo ON a.BroughtInByOwnerID = bo.ID
WHERE m.MovementType = 1 AND m.MovementDate >= '$@from$' AND m.MovementDate <= '$@to$' AND a.SpeciesID IN (1, 2) ORDER BY MovementDate
###
$$HEADER
<table border=1><tr>
<td><b>Date Dog Acquired</b></td>
<td><b>Acquired From</b></td>
<td><b>Dog or Cat</b></td>
<td><b>Animal Name</b></td>
<td><b>Age</b></td>
<td><b>Sex</b></td>
<td><b>Breed</b></td>
<td><b>Date of Rabies</b></td>
<td><b>Date of DHPP</b></td>
<td><b>Date of FVCRP</b></td>
<td><b>Date of Lepto</b></td>
<td><b>Date of 4DX</b></td>
<td><b>Result of 4DX</b></td>
<td><b>Date of Import</b></td>
</tr>
HEADER$$

$$BODY
<tr>
<td>$DATEDOGACQUIRED</td>
<td>$ACQUIREDFROM</td>
<td>$SPECIESNAME</td>
<td>$ANIMALNAME</td>
<td>$ANIMALAGE</td>
<td>$SEX</td>
<td>$BREEDNAME</td>
<td>$DATEOFRABIES</td>
<td>$DATEOFDHPP</td>
<td>$DATEOFFVCRP</td>
<td>$DATEOFLEPTO</td>
<td>$DATEOF4DX</td>
<td>$RESULTOF4DX</td>
<td>$DATEOFIMPORT</td>
</tr>
BODY$$

$$FOOTER
</table>
FOOTER$$

