Medical, Vaccination and Tests due between two dates
###
Diary
###
3309/Any
###
Medical, vaccination and tests due between two dates in one report
###
en
###
$VAR from DATE Enter from date$
$VAR to DATE Enter to date$

SELECT * FROM
(

SELECT
'Medical' AS mtype, a.ShelterCode, a.AnimalName, a.ID AS AID,
t.AnimalType, s.SpeciesName, il.LocationName, 
am.TreatmentName, am.Dosage, amt.TreatmentNumber, 
amt.TotalTreatments, amt.DateRequired, am.Comments
FROM animal a
INNER JOIN animaltype t ON t.ID = a.AnimalTypeID
INNER JOIN species s ON s.ID = a.SpeciesID
INNER JOIN internallocation il ON il.ID = a.ShelterLocation
INNER JOIN animalmedical am ON a.ID = am.AnimalID
INNER JOIN animalmedicaltreatment amt ON amt.AnimalMedicalID = am.ID
WHERE amt.DateGiven Is Null 
AND amt.DateRequired >= '$@from$' AND amt.DateRequired <= '$@to$'
AND a.Archived = 0 AND a.DeceasedDate Is Null

UNION SELECT
'Vaccination' AS mtype, a.ShelterCode, a.AnimalName, a.ID AS AID, 
t.AnimalType, sp.SpeciesName, il.LocationName,
v.VaccinationType AS TreatmentName, '1' AS Dosage, '1' AS TreatmentNumber,
'1' AS TotalTreatments, av.DateRequired, av.Comments
FROM animal a
INNER JOIN animaltype t ON t.ID = a.AnimalTypeID
INNER JOIN animalvaccination av ON a.ID = av.AnimalID
INNER JOIN species sp ON sp.ID = a.SpeciesID
INNER JOIN vaccinationtype v ON av.VaccinationID = v.ID
INNER JOIN internallocation il ON il.ID = a.ShelterLocation
WHERE av.DateOfVaccination Is Null
AND av.DateRequired >= '$@from$' AND av.DateRequired <= '$@to$'
AND a.Archived = 0 AND a.DeceasedDate Is Null

UNION SELECT
'Test' AS mtype, a.ShelterCode, a.AnimalName, a.ID AS AID, 
t.AnimalType, sp.SpeciesName, il.LocationName,
tt.TestName AS TreatmentName, '1' AS Dosage, '1' AS TreatmentNumber,
'1' AS TotalTreatments, at.DateRequired, at.Comments
FROM animal a
INNER JOIN animaltype t ON t.ID = a.AnimalTypeID
INNER JOIN animaltest at ON a.ID = at.AnimalID
INNER JOIN species sp ON sp.ID = a.SpeciesID
INNER JOIN testtype tt ON at.TestTypeID = tt.ID
INNER JOIN internallocation il ON il.ID = a.ShelterLocation
WHERE at.DateOfTest Is Null
AND at.DateRequired >= '$@from$' AND at.DateRequired <= '$@to$'
AND a.Archived = 0 AND a.DeceasedDate Is Null

) dummy
ORDER BY DateRequired

###
$$HEADER
<table border=1><tr>
<td><b>Animal</b></td>
<td><b>Type</b></td>
<td><b>Species</b></td>
<td><b>Internal Loc</b></td>
<td><b>Therapy</b></td>
<td><b>Dosage</b></td>
<td><b>Number</b></td>
<td><b>Date Required</b></td>
<td><b>Comments</b></td>
</tr>
HEADER$$

$$BODY<tr>
<td><a target="_blank" href="animal?id=$AID">$SHELTERCODE $ANIMALNAME</a></td>
<td>$ANIMALTYPE</td>
<td>$SPECIESNAME</td>
<td>$LOCATIONNAME</td>
<td><b>$MTYPE: $TREATMENTNAME</b></td>
<td>$DOSAGE</td>
<td>$TREATMENTNUMBER / $TOTALTREATMENTS</td>
<td>$DATEREQUIRED</td>
<td>$COMMENTS</td>
</tr>
BODY$$

$$FOOTER
</table>
FOOTER$$
&&&
Medical, Vaccination and Tests given between two dates
###
Diary
###
3309/Any
###
Medical, vaccination and tests given to shelter animals between two dates in one report
###
en
###
$VAR from DATE Enter from date$
$VAR to DATE Enter to date$

SELECT * FROM
(

SELECT
'Medical' AS mtype, a.ShelterCode, a.AnimalName, a.ID AS AID,
t.AnimalType, s.SpeciesName, il.LocationName, 
am.TreatmentName, am.Dosage, amt.TreatmentNumber, 
amt.TotalTreatments, amt.DateGiven, am.Comments
FROM animal a
INNER JOIN animaltype t ON t.ID = a.AnimalTypeID
INNER JOIN species s ON s.ID = a.SpeciesID
INNER JOIN internallocation il ON il.ID = a.ShelterLocation
INNER JOIN animalmedical am ON a.ID = am.AnimalID
INNER JOIN animalmedicaltreatment amt ON amt.AnimalMedicalID = am.ID
WHERE amt.DateGiven Is Not Null 
AND amt.DateGiven >= '$@from$' AND amt.DateGiven <= '$@to$'
AND a.Archived = 0 AND a.DeceasedDate Is Null

UNION SELECT
'Vaccination' AS mtype, a.ShelterCode, a.AnimalName, a.ID AS AID, 
t.AnimalType, sp.SpeciesName, il.LocationName,
v.VaccinationType AS TreatmentName, '1' AS Dosage, '1' AS TreatmentNumber,
'1' AS TotalTreatments, av.DateOfVaccination AS DateGiven, av.Comments
FROM animal a
INNER JOIN animaltype t ON t.ID = a.AnimalTypeID
INNER JOIN animalvaccination av ON a.ID = av.AnimalID
INNER JOIN species sp ON sp.ID = a.SpeciesID
INNER JOIN vaccinationtype v ON av.VaccinationID = v.ID
INNER JOIN internallocation il ON il.ID = a.ShelterLocation
WHERE av.DateOfVaccination Is Not Null
AND av.DateOfVaccination >= '$@from$' AND av.DateOfVaccination <= '$@to$'
AND a.Archived = 0 AND a.DeceasedDate Is Null

UNION SELECT
'Test' AS mtype, a.ShelterCode, a.AnimalName, a.ID AS AID, 
t.AnimalType, sp.SpeciesName, il.LocationName,
tt.TestName AS TreatmentName, '1' AS Dosage, '1' AS TreatmentNumber,
'1' AS TotalTreatments, at.DateOfTest AS DateGiven, at.Comments
FROM animal a
INNER JOIN animaltype t ON t.ID = a.AnimalTypeID
INNER JOIN animaltest at ON a.ID = at.AnimalID
INNER JOIN species sp ON sp.ID = a.SpeciesID
INNER JOIN testtype tt ON at.TestTypeID = tt.ID
INNER JOIN internallocation il ON il.ID = a.ShelterLocation
WHERE at.DateOfTest Is Not Null
AND at.DateOfTest >= '$@from$' AND at.DateOfTest <= '$@to$'
AND a.Archived = 0 AND a.DeceasedDate Is Null

) dummy
ORDER BY DateGiven

###
$$HEADER
<table border=1><tr>
<td><b>Animal</b></td>
<td><b>Type</b></td>
<td><b>Species</b></td>
<td><b>Internal Loc</b></td>
<td><b>Therapy</b></td>
<td><b>Dosage</b></td>
<td><b>Number</b></td>
<td><b>Date Given</b></td>
<td><b>Comments</b></td>
</tr>
HEADER$$

$$BODY<tr>
<td><a target="_blank" href="animal?id=$AID">$SHELTERCODE $ANIMALNAME</a></td>
<td>$ANIMALTYPE</td>
<td>$SPECIESNAME</td>
<td>$LOCATIONNAME</td>
<td><b>$MTYPE: $TREATMENTNAME</b></td>
<td>$DOSAGE</td>
<td>$TREATMENTNUMBER / $TOTALTREATMENTS</td>
<td>$DATEGIVEN</td>
<td>$COMMENTS</td>
</tr>
BODY$$

$$FOOTER
</table>
FOOTER$$
