Average Cost Per Animal by Date and Species
###
Financial
###
2707/Any
###
Average cost per animal considering medical, vaccination and costs. Only considers adopted/cost complete animals between two dates.
###
en
###
$VAR fromdate DATE Consider animals adopted between$
$VAR todate DATE and$

SELECT
(SELECT COUNT(*) FROM animal WHERE SpeciesID = 1 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$') AS TotalDogs,

(SELECT COUNT(*) FROM animal WHERE SpeciesID = 2 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$') AS TotalCats,

COALESCE((SELECT SUM(CostAmount) FROM animalcost INNER JOIN animal ON animal.ID = animalcost.AnimalID WHERE SpeciesID = 1 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$'), 0) +
COALESCE((SELECT SUM(Cost) FROM animalvaccination INNER JOIN animal ON animal.ID = animalvaccination.AnimalID WHERE SpeciesID = 1 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$'), 0) +
COALESCE((SELECT SUM(Cost) FROM animalmedical INNER JOIN animal ON animal.ID = animalmedical.AnimalID WHERE SpeciesID = 1 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$'), 0) AS CostDogs,

COALESCE((SELECT SUM(CostAmount) FROM animalcost INNER JOIN animal ON animal.ID = animalcost.AnimalID WHERE SpeciesID = 2 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$'), 0) +
COALESCE((SELECT SUM(Cost) FROM animalvaccination INNER JOIN animal ON animal.ID = animalvaccination.AnimalID WHERE SpeciesID = 2 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$'), 0) +
COALESCE((SELECT SUM(Cost) FROM animalmedical INNER JOIN animal ON animal.ID = animalmedical.AnimalID WHERE SpeciesID = 2 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$'), 0) AS CostCats,


(COALESCE((SELECT SUM(CostAmount) FROM animalcost INNER JOIN animal ON animal.ID = animalcost.AnimalID WHERE SpeciesID = 1 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$'), 0) +
COALESCE((SELECT SUM(Cost) FROM animalvaccination INNER JOIN animal ON animal.ID = animalvaccination.AnimalID WHERE SpeciesID = 1 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$'), 0) +
COALESCE((SELECT SUM(Cost) FROM animalmedical INNER JOIN animal ON animal.ID = animalmedical.AnimalID WHERE SpeciesID = 1 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$'), 0)) / (SELECT COUNT(*) FROM animal WHERE SpeciesID = 1 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$') AS AmountDogs, 

(COALESCE((SELECT SUM(CostAmount) FROM animalcost INNER JOIN animal ON animal.ID = animalcost.AnimalID WHERE SpeciesID = 2 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$'), 0) +
COALESCE((SELECT SUM(Cost) FROM animalvaccination INNER JOIN animal ON animal.ID = animalvaccination.AnimalID WHERE SpeciesID = 2 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$'), 0) +
COALESCE((SELECT SUM(Cost) FROM animalmedical INNER JOIN animal ON animal.ID = animalmedical.AnimalID WHERE SpeciesID = 2 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$'), 0)) / (SELECT COUNT(*) FROM animal WHERE SpeciesID = 2 AND ActiveMovementType = 1 AND ActiveMovementDate >= '$@fromdate$' AND ActiveMovementDate <= '$@todate$') AS AmountCats

FROM animal LIMIT 1
###
$$HEADER
HEADER$$

$$BODY
<table>
<tr>
<td>Number of adopted dogs:</td>
<td>$TOTALDOGS</td>
</tr>
<tr>
<td>Total costs of all adopted dogs:</td>
<td>$COSTDOGS</td>
</tr>
<tr>
<td>Average cost per dog:</td>
<td>$AMOUNTDOGS</td>
</tr>
<tr>
<td>Number of adopted cats:</td>
<td>$TOTALCATS</td>
</tr>
<tr>
<td>Total costs of all adopted cats:</td>
<td>$COSTCATS</td>
</tr>
<tr>
<td>Average cost per cat:</td>
<td>$AMOUNTCATS</td>
</tr>
</table>
BODY$$

$$FOOTER
FOOTER$$
